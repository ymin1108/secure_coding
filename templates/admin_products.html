{% extends "base.html" %}
{% block title %}ê´€ë¦¬ì: ìƒí’ˆ ê´€ë¦¬{% endblock %}
{% block content %}
<div class="container mt-5">
    <h2>ìƒí’ˆ ê´€ë¦¬</h2>
    
    {% if products %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ì´ë¯¸ì§€</th>
                        <th>ID</th>
                        <th>ì œëª©</th>
                        <th>íŒë§¤ì</th>
                        <th>ê°€ê²©</th>
                        <th>ìƒíƒœ</th>
                        <th>ì‹ ê³  íšŸìˆ˜</th>
                        <th>ë“±ë¡ì¼</th>
                        <th>ì‘ì—…</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in products %}
                        <tr>
                            <td>
                                {% if product.image_path %}
                                    <img src="{{ url_for('uploaded_file', filename=product.image_path.split('/')[-1]) }}" 
                                         alt="{{ product.title }}" class="product-thumbnail">
                                {% else %}
                                    <div class="no-image-placeholder">
                                        <i class="no-image-icon">ğŸ–¼ï¸</i>
                                    </div>
                                {% endif %}
                            </td>
                            <td>{{ product.id[:8] }}...</td>
                            <td>
                                <a href="{{ url_for('view_product', product_id=product.id) }}">
                                    {{ product.title }}
                                </a>
                            </td>
                            <td>{{ product.seller_name }}</td>
                            <td>{{ product.price }}</td>
                            <td>
                                {% if product.status == 'active' %}
                                    <span class="badge badge-success">ì •ìƒ</span>
                                {% elif product.status == 'warning' %}
                                    <span class="badge badge-warning">ì£¼ì˜</span>
                                {% elif product.status == 'blocked' %}
                                    <span class="badge badge-danger">ì°¨ë‹¨ë¨</span>
                                {% endif %}
                            </td>
                            <td>{{ product.report_count }}</td>
                            <td>{{ product.created_at }}</td>
                            <td>
                                <form method="POST" action="{{ url_for('change_product_status', product_id=product.id) }}" class="d-inline">
                                    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                                    <select name="status" class="form-control form-control-sm d-inline-block" style="width: auto;">
                                        <option value="active" {% if product.status == 'active' %}selected{% endif %}>ì •ìƒ</option>
                                        <option value="warning" {% if product.status == 'warning' %}selected{% endif %}>ì£¼ì˜</option>
                                        <option value="blocked" {% if product.status == 'blocked' %}selected{% endif %}>ì°¨ë‹¨</option>
                                    </select>
                                    <button type="submit" class="btn btn-sm btn-primary">ë³€ê²½</button>
                                </form>
                                
                                <!-- ìƒí’ˆ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ -->
                                <form method="POST" action="{{ url_for('admin_delete_product', product_id=product.id) }}" class="d-inline" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');">
                                    <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}">
                                    <button type="submit" class="btn btn-sm btn-danger">ì‚­ì œ</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="alert alert-info">
            ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.
        </div>
    {% endif %}
    
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
</div>

<style>
    .product-thumbnail {
        max-height: 50px;
        max-width: 50px;
        object-fit: cover;
    }
    
    .no-image-placeholder {
        height: 50px;
        width: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f8f9fa;
        border-radius: 5px;
    }
    
    .no-image-icon {
        font-size: 24px;
        color: #adb5bd;
    }
</style>
{% endblock %}